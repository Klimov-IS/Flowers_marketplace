# ADR-001: Dictionary-driven нормализация

## Статус

Accepted

## Дата

2025-01-12

## Контекст

Платформа должна сопоставлять позиции из прайсов поставщиков (raw_name) с каноническими SKU. Варианты реализации:

1. **ML-based**: обучить модель на исторических данных
2. **Rule-based**: жёсткие regex-правила
3. **Dictionary-driven**: управляемый словарь + confidence scoring

Требования:
- Быстрый запуск без обучающих данных (cold start)
- Возможность оперативной корректировки без деплоя
- Прозрачность решений (explainability)
- Масштабируемость на новые типы товаров

## Решение

Использовать **dictionary-driven подход** с manual review workflow:

1. Словарь (`dictionary_entries`) хранит:
   - Типы продуктов и синонимы
   - Алиасы сортов
   - Regex-правила извлечения атрибутов
   - Стоп-слова

2. Алгоритм propose:
   - Извлечь атрибуты (product_type, variety, subtype)
   - Найти кандидатов в normalized_skus
   - Рассчитать confidence score
   - Создать task для low confidence

3. Manual confirmation обязателен перед публикацией

## Последствия

### Плюсы

- **Cold start**: работает сразу, без обучения
- **Explainability**: можно объяснить каждое решение
- **Operability**: оператор может править словарь на лету
- **No vendor lock-in**: нет зависимости от ML-сервисов
- **Предсказуемость**: детерминированный алгоритм

### Минусы

- **Manual effort**: требуется оператор для низкого confidence
- **Scaling**: при росте словаря может потребоваться оптимизация
- **Limited learning**: не улучшается автоматически от данных

### Mitigation

- Очередь задач приоритизируется по важности
- Auto-confirm для high confidence (опционально)
- В будущем: добавить ML как дополнительный сигнал

## Альтернативы

### ML-based

- Плюс: автоматическое улучшение
- Минус: требует training data, black box, сложнее debug

### Rule-based only

- Плюс: простота
- Минус: хрупкость, сложно поддерживать
