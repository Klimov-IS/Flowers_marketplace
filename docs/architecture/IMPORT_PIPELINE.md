# üîÑ IMPORT_PIPELINE ‚Äî MVP (raw ‚Üí parsed ‚Üí normalized ‚Üí published)

## 0) –¶–µ–ª—å

–û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –∏ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–π –∏–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:
- ‚Äú—Å—Ç—Ä–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞‚Äù (–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ/—Ü–µ–Ω–∞/–∫–æ–ª-–≤–æ/‚Ä¶)
- ‚Äú–∏–µ—Ä–∞—Ä—Ö–∏—è‚Äù (–≥—Ä—É–ø–ø–∞ ‚Üí –ø–æ–∑–∏—Ü–∏–∏)
- ‚Äú–º–∞—Ç—Ä–∏—Ü–∞ —Ü–µ–Ω‚Äù (–¥–ª–∏–Ω–∞ √ó —É–ø–∞–∫–æ–≤–∫–∞)
- ‚Äú—Ç–∏—Ä—ã –ø–æ –æ–±—ä—ë–º—É‚Äù (–æ—Ç 100 –¥–æ 200 —à—Ç)
- ‚Äú–¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ü–µ–Ω‚Äù (95‚Äì99)

Pipeline –æ–±—è–∑–∞–Ω:
- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å raw –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º,
- –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –≤—Ö–æ–¥ –≤ –ø–ª–æ—Å–∫–∏–µ offer_candidate,
- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏/–∞–Ω–æ–º–∞–ª–∏–∏,
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –∏ –ø–µ—Ä–µ–ø—É–±–ª–∏–∫–∞—Ü–∏—é.

---

## 1) –í—Ö–æ–¥—ã –∏ –≤—ã—Ö–æ–¥—ã

### –í—Ö–æ–¥
- —Ñ–∞–π–ª/–∏—Å—Ç–æ—á–Ω–∏–∫: CSV/XLSX/PDF/Image (–≤ MVP: CSV/XLSX first-class)
- supplier_id
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–∞—Ç–∞ –ø—Ä–∞–π—Å–∞/—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –í—ã—Ö–æ–¥
- import_batches.status = published
- offers –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–∞—Ä—Ç–∏–∏ + confirmed mappings

---

## 2) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞ (—ç—Ç–∞–ø—ã)

### Stage A ‚Äî Ingestion (–∑–∞–≥—Ä—É–∑–∫–∞)
**–¶–µ–ª—å:** —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–∏—é –∏–º–ø–æ—Ä—Ç–∞.

**–î–µ–π—Å—Ç–≤–∏—è:**
1) —Å–æ–∑–¥–∞—ë–º `import_batches`:
   - supplier_id
   - source_type
   - source_filename
   - declared_effective_date (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - status = received

2) —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –≤ storage (S3/Yandex Object Storage) –∏ –∫–ª–∞–¥—ë–º –≤ `import_batches.meta`:
   - file_url / storage_key
   - file_hash (sha256)
   - uploader (user_id)

**–¢–∞–±–ª–∏—Ü—ã:**
- import_batches

---

### Stage B ‚Äî RAW extraction (—Ä–∞–∑–±–æ—Ä –Ω–∞ —Å—Ç—Ä–æ–∫–∏/—è—á–µ–π–∫–∏)
**–¶–µ–ª—å:** —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å raw ‚Äú–∫–∞–∫ –µ—Å—Ç—å‚Äù.

**–î–µ–π—Å—Ç–≤–∏—è:**
1) —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª:
   - CSV: rows ‚Üí –º–∞—Å—Å–∏–≤—ã —è—á–µ–µ–∫
   - XLSX: –ª–∏—Å—Ç—ã ‚Üí —Å—Ç—Ä–æ–∫–∏ ‚Üí —è—á–µ–π–∫–∏
   - PDF/Image: –ø–æ–∫–∞ —á–µ—Ä–µ–∑ OCR/—Ä—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç (–≤ MVP –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å)

2) –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –ø–∏—à–µ–º `raw_rows`:
   - raw_cells (json)
   - raw_text (–∫–æ–Ω–∫–∞—Ç —è—á–µ–µ–∫)
   - row_ref (sheet/page/row)

3) –ø–µ—Ä–≤–∏—á–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è row_kind:
   - header / group / data / comment / empty

**–¢–∞–±–ª–∏—Ü—ã:**
- raw_rows

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- parse_events (–µ—Å–ª–∏ —Ñ–∞–π–ª –±–∏—Ç—ã–π/–Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è)

---

### Stage C ‚Äî Parse run (—Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π)
**–¶–µ–ª—å:** —Å–æ–∑–¥–∞—Ç—å parse_run –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å parsed —Å–ª–æ–π.

**–î–µ–π—Å—Ç–≤–∏—è:**
1) —Å–æ–∑–¥–∞—ë–º `parse_runs`:
   - parser_version
   - started_at

2) –æ–ø—Ä–µ–¥–µ–ª—è–µ–º ‚Äú—Ñ–æ—Ä–º–∞—Ç‚Äù –ø–∞—Ä—Ç–∏–∏ (heuristics):
   - –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–æ–∫ ‚Äú–¶–µ–Ω–∞/–ö–æ–ª-–≤–æ/–°—É–º–º–∞‚Äù
   - –Ω–∞–ª–∏—á–∏–µ –º–∞—Ç—Ä–∏—Ü—ã (–∫–æ–ª–æ–Ω–∫–∏ –≤–∏–¥–∞ ‚Äú40 —Å–º –±–∞–∫ / 50 —Å–º —É–ø–∞–∫‚Äù)
   - –Ω–∞–ª–∏—á–∏–µ —Ç–∏—Ä–æ–≤ –ø–æ –æ–±—ä—ë–º—É (‚Äú–æ—Ç 100 –¥–æ 200‚Äù)
   - –Ω–∞–ª–∏—á–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (‚Äú95-99‚Äù, ‚Äú95‚Äì99‚Äù, ‚Äú95—Ä - 99—Ä‚Äù)

3) —Å—Ç—Ä–æ–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:
   - –µ—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ–º —Å—Ç—Ä–æ–∫–∏-–≥—Ä—É–ø–ø—ã: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π `raw_group_context`
   - –∫–∞–∂–¥–æ–π data-—Å—Ç—Ä–æ–∫–µ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º raw_group = group_context

4) –∏–∑–≤–ª–µ–∫–∞–µ–º supplier_item:
   - raw_name = –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–∫–∞–∫ –µ—Å—Ç—å)
   - raw_group = group_context (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - name_norm = –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (lower, trim, replace, remove stopwords)
   - attributes (json): —Å—Ç—Ä–∞–Ω–∞/–±—Ä–µ–Ω–¥/—Å–æ—Ä—Ç (–µ—Å–ª–∏ –∏–∑–≤–ª–µ–∫–ª–∏)
   - stable_key = hash(supplier_id + raw_group + normalized_name)

5) –∏–∑–≤–ª–µ–∫–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ raw_name (**–∏—Å–ø–æ–ª—å–∑—É—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥**):
   - **flower_type** ‚Äî —Ç–∏–ø —Ü–≤–µ—Ç–∫–∞ (–†–æ–∑–∞, –•—Ä–∏–∑–∞–Ω—Ç–µ–º–∞...)
     - lookup –∏–∑ `flower_types` + `type_synonyms` —Å –∫—ç—à–µ–º (TTL=5 –º–∏–Ω)
     - fallback –Ω–∞ hardcoded —Å–ª–æ–≤–∞—Ä—å FLOWER_TYPES_FALLBACK
   - **flower_subtype** ‚Äî —Å—É–±—Ç–∏–ø (–ö—É—Å—Ç–æ–≤–∞—è, –°–ø—Ä–µ–π, –ü–∏–æ–Ω–æ–≤–∏–¥–Ω–∞—è)
     - lookup –∏–∑ `flower_subtypes` + `subtype_synonyms` (–ø–æ type_id)
   - **variety** ‚Äî —Å–æ—Ä—Ç (–æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–∏–ø–∞/—Å—É–±—Ç–∏–ø–∞/—Å—Ç—Ä–∞–Ω—ã/–¥–ª–∏–Ω—ã)
   - **origin_country** ‚Äî —Å—Ç—Ä–∞–Ω–∞ (–∏–∑ —Å–∫–æ–±–æ–∫ –∏–ª–∏ —Ä–µ–≥—É–ª—è—Ä–∫–∏)
   - **length_cm** ‚Äî –¥–ª–∏–Ω–∞ –≤ —Å–º
   - **colors** ‚Äî —Ü–≤–µ—Ç–∞ (–º–∏–∫—Å, –∫—Ä–∞—Å–Ω—ã–π –∏ —Ç.–¥.)

   > –ü–∞—Ä—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API `/admin/catalog/lookup` –∏–ª–∏ –ø—Ä—è–º–æ–π async –∑–∞–ø—Ä–æ—Å –∫ –ë–î.

5) –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ —Å–æ–∑–¥–∞—ë–º `offer_candidates` (—Å–º. Stage D ‚Äî —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ).

**–¢–∞–±–ª–∏—Ü—ã:**
- parse_runs
- supplier_items
- offer_candidates (—á–µ—Ä–µ–∑ Stage D)
- parse_events (–æ—à–∏–±–∫–∏)

---

### Stage D ‚Äî Expansion (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –º–∞—Ç—Ä–∏—Ü/—Ç–∏—Ä–æ–≤/–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≤ ‚Äú–ø–ª–æ—Å–∫–∏–µ‚Äù offer_candidate)
**–¶–µ–ª—å:** –ª—é–±–æ–π —Å–ª–æ–∂–Ω—ã–π –ø—Ä–∞–π—Å –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –≤–∏–¥—É: –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å = –æ–¥–∏–Ω ‚Äú–∫–∞–Ω–¥–∏–¥–∞—Ç –æ—Ñ—Ñ–µ—Ä–∞‚Äù.

#### D1) –û–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (simple row)
**–ü—Ä–∏–º–µ—Ä:** –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ + –¶–µ–Ω–∞ (+ –ö–æ–ª-–≤–æ)
- length_cm / pack_qty / origin / brand ‚Üí –ø–∞—Ä—Å–∏–º –∏–∑ raw_name regex-–∞–º–∏
- price_min = price
- price_type = fixed
- price_max = NULL

–°–æ–∑–¥–∞—ë–º 1 offer_candidate.

#### D2) –î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω—ã
**–ü—Ä–∏–º–µ—Ä:** 95‚Äì99
- price_type = range
- price_min = 95
- price_max = 99

#### D3) –¢–∏—Ä—ã –ø–æ –æ–±—ä—ë–º—É
**–ü—Ä–∏–º–µ—Ä:** ‚Äú–æ—Ç 100 –¥–æ 200 —à—Ç‚Äù –∫–∞–∫ –∫–æ–ª–æ–Ω–∫–∏/—Å—Ç—Ä–æ–∫–∏
- —Å–æ–∑–¥–∞—ë–º –Ω–µ—Å–∫–æ–ª—å–∫–æ offer_candidate:
  - tier_min_qty=100, tier_max_qty=200, price_min=...
  - tier_min_qty=201, tier_max_qty=500, price_min=...

> –í MVP —Ç–∏—Ä–∞–º–∏ —Å—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ dimension = qty (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ).

#### D4) –ú–∞—Ç—Ä–∏—Ü–∞ (–¥–ª–∏–Ω–∞ √ó —É–ø–∞–∫–æ–≤–∫–∞)
**–ü—Ä–∏–º–µ—Ä:** –∫–æ–ª–æ–Ω–∫–∏ ‚Äú40 —Å–º –±–∞–∫‚Äù, ‚Äú40 —Å–º —É–ø–∞–∫‚Äù, ‚Äú50 —Å–º –±–∞–∫‚Äù‚Ä¶
- –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —è—á–µ–π–∫–∏:
  - length_cm = 40/50/...
  - pack_type = –±–∞–∫/—É–ø–∞–∫
  - price_min = value
  - —Å–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—ã–π offer_candidate

#### D5) ‚Äú–°–ø–∏—Å–æ–∫ —Å–æ—Ä—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ‚Äù
**–ü—Ä–∏–º–µ—Ä:** ‚Äú–†–æ–∑–∞ –ê, –†–æ–∑–∞ –ë, –†–æ–∑–∞ –í‚Äù + –º–∞—Ç—Ä–∏—Ü–∞ —Ü–µ–Ω
- –≤ MVP –¥–æ–ø—É—Å—Ç–∏–º 2 —Ä–µ–∂–∏–º–∞:
  1) **SAFE MODE (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):** —Å–æ–∑–¥–∞—ë–º 1 supplier_item –Ω–∞ —Å—Ç—Ä–æ–∫—É (‚Äúbundle‚Äù), —Ç—Ä–µ–±—É–µ–º —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä.
  2) **SPLIT MODE (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):** –µ—Å–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∑–∞–ø—è—Ç–∞—è –∏ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Ö–æ–∂–∏ –Ω–∞ —Å–æ—Ä—Ç–∞ ‚Üí —Ä–µ–∂–µ–º –Ω–∞ N supplier_item.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: SAFE MODE.

**–¢–∞–±–ª–∏—Ü—ã:**
- offer_candidates
- parse_events (–µ—Å–ª–∏ –º–∞—Ç—Ä–∏—Ü–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ / —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

---

### Stage E ‚Äî Validation (–∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö)
**–¶–µ–ª—å:** –ø—Ä–∏—Å–≤–æ–∏—Ç—å validation_status –∫–∞–Ω–¥–∏–¥–∞—Ç—É –æ—Ñ—Ñ–µ—Ä–∞.

**–ü—Ä–∞–≤–∏–ª–∞ MVP:**
- error:
  - price_min is null / <0
  - tier_min_qty XOR tier_max_qty
  - length_cm <=0
- warn:
  - price_type=fixed, –Ω–æ price_max –∑–∞–ø–æ–ª–Ω–µ–Ω
  - pack_type –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω (–Ω–µ—Ç –≤ dictionary pack_type)
  - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (–≤ 10 —Ä–∞–∑ –≤—ã—à–µ –º–µ–¥–∏–∞–Ω—ã –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É)
- ok:
  - –≤—Å—ë –Ω–æ—Ä–º

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∏—à–µ–º –≤:
- offer_candidates.validation
- offer_candidates.validation_notes

---

### Stage F ‚Äî Mark batch parsed
**–¶–µ–ª—å:** –∑–∞–≤–µ—Ä—à–∏—Ç—å parse_run –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Ç–∏–∏.

**–î–µ–π—Å—Ç–≤–∏—è:**
- parse_runs.finished_at
- parse_runs.summary (counts)
- import_batches.status = parsed

---

### Stage G ‚Äî Normalization precompute (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–ø–ø–∏–Ω–≥–∞)
**–¶–µ–ª—å:** –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

**–î–µ–π—Å—Ç–≤–∏—è (MVP):**
- –¥–ª—è supplier_items, —É –∫–æ—Ç–æ—Ä—ã—Ö:
  - status=active
  - –Ω–µ—Ç confirmed mapping
  - –∑–∞–ø—É—Å–∫–∞–µ–º ‚Äúrule-based propose‚Äù:
    - —á–∏—Å—Ç–∏–º name_norm
    - –ø—Ä–∏–º–µ–Ω—è–µ–º dictionary rules (—Å–∏–Ω–æ–Ω–∏–º—ã, regex replacements)
    - –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ normalized_sku –ø–æ tokens

–°–æ–∑–¥–∞—ë–º sku_mappings —Å–æ status=proposed –∏ confidence.

*(–ü–æ–¥—Ä–æ–±–Ω–æ ‚Äî –≤ NORMALIZATION_RULES.md –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ.)*

---

### Stage H ‚Äî Publish (–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ offers)
**–¶–µ–ª—å:** –∏–∑ offer_candidates —Å–¥–µ–ª–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ offers.

**–£—Å–ª–æ–≤–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:**
- supplier.status=active
- sku_mappings.status=confirmed (–¥–ª—è supplier_item)
- offer_candidates.validation IN (ok, warn)

**–î–µ–π—Å—Ç–≤–∏—è:**
1) –≤—ã–±–∏—Ä–∞–µ–º latest import_batch –¥–ª—è supplier (–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—é)
2) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ supplier_item –±–µ—Ä—ë–º confirmed mapping ‚Üí normalized_sku_id
3) –ø–æ –∫–∞–∂–¥–æ–º—É offer_candidate —Å–æ–∑–¥–∞—ë–º offers:
   - –ø–µ—Ä–µ–Ω–æ—Å–∏–º length_cm/pack_type/pack_qty/price/tier/availability/stock
   - source_import_batch_id = import_batch_id
   - is_active=true
4) –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ offers —ç—Ç–æ–≥–æ supplier, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –Ω–æ–≤–æ–π –ø–∞—Ä—Ç–∏–∏ (–∏–ª–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º is_active=false –ø–æ strategy)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ (MVP):**
- –¥–ª—è –∫–∞–∂–¥–æ–≥–æ supplier –ø—É–±–ª–∏–∫—É–µ–º —Ç–æ–ª—å–∫–æ offers –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π successful –ø–∞—Ä—Ç–∏–∏
- —Å—Ç–∞—Ä—ã–µ offers ‚Üí is_active=false

**–¢–∞–±–ª–∏—Ü—ã:**
- offers
- import_batches.status = published

---

## 3) –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –¥–µ–±–∞–≥

### KPI –ø–æ –ø–∞—Ä—Ç–∏–∏
–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ parse_runs.summary:
- raw_rows_total
- raw_rows_data
- supplier_items_created
- offer_candidates_created
- validation_ok / warn / error
- unmapped_items_count
- publishable_candidates_count

### –õ–æ–≥–∏/–æ—à–∏–±–∫–∏
- parse_events: –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è, –º–∞—Ç—Ä–∏—Ü–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞, –º—É—Å–æ—Ä–Ω—ã–µ —Ü–µ–Ω—ã, etc.

### Re-run —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- Raw –Ω–µ –º–µ–Ω—è–µ–º.
- –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∞:
  - —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π parse_run –¥–ª—è —Ç–æ–π –∂–µ import_batch
  - –ª–∏–±–æ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é import_batch, –µ—Å–ª–∏ —Ñ–∞–π–ª –∏–∑–º–µ–Ω–∏–ª—Å—è

---

## 4) –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è MVP (–≤–∞–∂–Ω—ã–µ)

1) PDF/Image ‚Äî –Ω–µ first-class (—Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç –∏–ª–∏ OCR –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
2) –ú–∞—Ç—Ä–∏—Ü—ã –∏ —Ç–∏—Ä—ã –≤—Å–µ–≥–¥–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –≤ –ø–ª–æ—Å–∫–∏–µ offer_candidate.
3) ‚Äú–°–ø–∏—Å–æ–∫ —Å–æ—Ä—Ç–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ‚Äù –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Üí SAFE MODE (—Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä).
4) –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ confirmed mapping.
5) –õ—é–±–∞—è –æ—à–∏–±–∫–∞ –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è –≤ raw + parse_events.