# üß© CORE_DATA_MODEL ‚Äî B2B Flower Market Platform (MVP)

## 0) –¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞

–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å:
- –∫–ª—é—á–µ–≤—ã–µ **—Å—É—â–Ω–æ—Å—Ç–∏** –∏ **—Å–≤—è–∑–∏**,
- **—Å–ª–æ–∏ –¥–∞–Ω–Ω—ã—Ö** (raw ‚Üí parsed ‚Üí normalized ‚Üí published),
- –±–∞–∑–æ–≤—ã–µ **–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã** (—á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è ‚Äú–∏—Å—Ç–∏–Ω–æ–π‚Äù, —á—Ç–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è),
- –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∞–π—Å—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:
  - –ø—Ä–æ—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏ `–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ/–¶–µ–Ω–∞`,
  - –∏–µ—Ä–∞—Ä—Ö–∏–∏ ‚Äú–∫–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üí –ø–æ–∑–∏—Ü–∏–∏‚Äù,
  - **–º–∞—Ç—Ä–∏—Ü—ã —Ü–µ–Ω** (–¥–ª–∏–Ω–∞ √ó —Ç–∏–ø —É–ø–∞–∫–æ–≤–∫–∏),
  - **—Ç–∏—Ä—ã –ø–æ –æ–±—ä—ë–º—É** (‚Äú–æ—Ç 100 –¥–æ 200 —à—Ç‚Äù),
  - **–¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ü–µ–Ω** (95‚Äì99).

---

## 1) –ì–ª–æ—Å—Å–∞—Ä–∏–π

- **Raw** ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äú–∫–∞–∫ –µ—Å—Ç—å‚Äù (—Ñ–∞–π–ª, —Å—Ç—Ä–æ–∫–∏, —è—á–µ–π–∫–∏). –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è.
- **Parsed** ‚Äî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è, –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –∏–∑ raw (price, length_cm, pack_qty‚Ä¶).
- **Normalized SKU** ‚Äî –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞), –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º–∞–ø–ø—è—Ç—Å—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.
- **Supplier Item** ‚Äî –ø–æ–∑–∏—Ü–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –≤ –µ–≥–æ –Ω–æ—Ç–∞—Ü–∏–∏ (–∫–∞–∫ –≤ –ø—Ä–∞–π—Å–µ).
- **Offer** ‚Äî –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: *Supplier + SKU + —É–ø–∞–∫–æ–≤–∫–∞/–¥–ª–∏–Ω–∞/—Ç–∏—Ä—ã + —Ü–µ–Ω–∞(+–Ω–∞–ª–∏—á–∏–µ)*.
- **Published Offer** ‚Äî –æ—Ñ—Ñ–µ—Ä, –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ä–æ–∑–Ω–∏—Ü–µ –≤ –ø–æ–∏—Å–∫–µ (–ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏/–≤–∞–ª–∏–¥–∞—Ü–∏–∏).

---

## 2) –°–ª–æ–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

### 2.1 RAW (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –ø–æ –∏–º–ø–æ—Ä—Ç—É)
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- —Ñ–∞–π–ª (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ),
- –∏–º–ø–æ—Ä—Ç-–ø–∞—Ä—Ç–∏—é,
- —Å—Ç—Ä–æ–∫–∏/—è—á–µ–π–∫–∏ (–≤ JSON/–º–∞—Å—Å–∏–≤–µ),
- —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ (sheet/page/row).

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- Raw **–Ω–µ –º–µ–Ω—è–µ–º** –Ω–∏–∫–æ–≥–¥–∞.
- –õ—é–±—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí —á–µ—Ä–µ–∑ parsed/normalized, –Ω–æ —Å –ª–∏–Ω–∫–æ–º –Ω–∞ raw.

---

### 2.2 PARSED (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã)
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–æ–ª—è –∏–∑ raw: name, group, price, price_range, length_cm, pack_type, pack_qty, tier rules –∏ —Ç.–¥.
- —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äú—Ä–∞—Å–∫—Ä—ã—Ç–∏—è‚Äù –º–∞—Ç—Ä–∏—Ü/—Ç–∏—Ä–æ–≤:
  - –æ–¥–Ω–∞ raw-—Å—Ç—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –ø–æ—Ä–æ–¥–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ parsed-—ç–ª–µ–º–µ–Ω—Ç–æ–≤**.

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- Parsed –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ `import_batch_id` –∏ `parse_run_id`.
- –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏—è (–Ω–µ ‚Äú—Ç–µ—Ä—è–µ–º‚Äù —Å—Ç—Ä–æ–∫–∏).

---

### 2.3 NORMALIZED (–µ–¥–∏–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ + –º–∞–ø–ø–∏–Ω–≥)
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- `normalized_sku` (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏),
- —Å–ª–æ–≤–∞—Ä–∏/—Å–∏–Ω–æ–Ω–∏–º—ã/–ø—Ä–∞–≤–∏–ª–∞,
- —Ç–∞–±–ª–∏—Ü—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π `supplier_item ‚Üí normalized_sku` —Å confidence.

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π, –¥–æ–ø—É—Å–∫–∞—é—â–∏–π —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ö—Ä–∞–Ω–∏–º: –º–µ—Ç–æ–¥, confidence, –∫—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, –∫–æ–≥–¥–∞.

---

### 2.4 PUBLISHED (—Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç —Ä–æ–∑–Ω–∏—Ü–∞)
**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ `offers`, –ø—Ä–æ—à–µ–¥—à–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –º–∞–ø–ø–∏–Ω–≥,
- —Å–Ω–∞–±–∂—ë–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è–º–∏ (–¥–æ—Å—Ç–∞–≤–∫–∞/–º–∏–Ω–∏–º–∞–ª–∫–∞),
- –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã/—Ç–∏—Ä—ã.

**–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- Published = —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç (latest valid price_list + mapping + delivery rules).
- –ú–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å published –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–æ–≤–∞—Ä—è.

---

## 3) –°—É—â–Ω–æ—Å—Ç–∏ MVP –∏ —Å–≤—è–∑–∏ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è ER-–º–æ–¥–µ–ª—å)

### 3.1 –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –∏ –¥–æ—Å—Ç—É–ø

#### `supplier` (–û–ø—Ç–æ–≤–∞—è –±–∞–∑–∞)
- id
- name
- city_id
- status (pending/active/blocked)
- contacts (json)

#### `buyer` (–†–æ–∑–Ω–∏—Ü–∞)
- id
- name
- city_id
- status
- contacts (json)

#### `telegram_link` (–ü—Ä–∏–≤—è–∑–∫–∞ Telegram ‚Üí –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
–°–≤—è–∑—å –º–µ–∂–¥—É Telegram-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —Å—É—â–Ω–æ—Å—Ç—å—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (supplier/buyer).
- id (UUID)
- telegram_user_id (BigInteger, unique) ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- telegram_chat_id (BigInteger) ‚Äî ID —á–∞—Ç–∞
- role (String(20)) ‚Äî 'supplier' –∏–ª–∏ 'buyer'
- entity_id (UUID) ‚Äî FK –Ω–∞ supplier.id –∏–ª–∏ buyer.id
- username (String(100), nullable) ‚Äî @username –≤ Telegram
- first_name (String(100), nullable)
- is_active (Boolean, default true)
- created_at, updated_at

**–ò–Ω–¥–µ–∫—Å—ã:** `(role, entity_id)`, `(telegram_chat_id)`

**–°–≤—è–∑—å:** –æ–¥–∏–Ω Telegram-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω —Ç–æ–ª—å–∫–æ –∫ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (unique –ø–æ telegram_user_id).

*(Auth/users –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º ‚Äî –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏.)*

---

### 3.2 –ò–º–ø–æ—Ä—Ç –∏ RAW —Å–ª–æ–π

#### `import_batch`
–û–¥–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–π—Å–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º (–∏–ª–∏ –∞–¥–º–∏–Ω–æ–º).
- id
- supplier_id
- source_type (csv/xlsx/pdf/image/api)
- source_filename
- imported_at
- declared_effective_date (–µ—Å–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫ —É–∫–∞–∑–∞–ª)
- status (received/parsed/published/failed)

#### `raw_row`
–°—Ç—Ä–æ–∫–∏/—è—á–µ–π–∫–∏ ‚Äú–∫–∞–∫ –µ—Å—Ç—å‚Äù.
- id
- import_batch_id
- row_kind (data/header/group/comment/empty)
- raw_cells_json (array/object)
- raw_text (–∫–æ–Ω–∫–∞—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞/–¥–µ–±–∞–≥–∞)
- row_ref (sheet/page/row)

#### `parse_run`
- id
- import_batch_id
- parser_version
- started_at / finished_at
- summary_json (—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫, —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫)

#### `parse_event` (–æ—à–∏–±–∫–∏/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- id
- parse_run_id
- raw_row_id
- severity (info/warn/error)
- code (–Ω–∞–ø—Ä–∏–º–µ—Ä: MATRIX_HEADER_NOT_FOUND)
- message
- payload_json

---

### 3.3 PARSED —Å–ª–æ–π (–ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)

#### `supplier_item`
–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è ‚Äú–ø–æ–∑–∏—Ü–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞‚Äù –∫–∞–∫ –æ–±—ä–µ–∫—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –º–∞–ø–ø–∏–Ω–≥.
- id
- supplier_id
- import_batch_id (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è/–∏—Å—Ç–æ—á–Ω–∏–∫)
- raw_name
- raw_group (—Å—Ç—Ä–∞–Ω–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏—è/—Ä–∞–∑–¥–µ–ª, –µ—Å–ª–∏ –µ—Å—Ç—å)
- name_norm (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –º–∞—Ç—á–∏–Ω–≥-–ø–æ–∏—Å–∫–∞)
- attributes_json (–≤—Å—ë, —á—Ç–æ –∏–∑–≤–ª–µ–∫–ª–∏: —Å—Ç—Ä–∞–Ω–∞, –±—Ä–µ–Ω–¥, —Å–æ—Ä—Ç –∏ —Ç.–ø.)
- status (active/ambiguous/rejected)

**–ó–∞—á–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π supplier_item:**
- –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ø–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∞–π—Å–∞—Ö,
- —ç—Ç–æ ‚Äú—É–∑–µ–ª‚Äù –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

#### `offer_candidate`
‚Äú–ö–∞–Ω–¥–∏–¥–∞—Ç –æ—Ñ—Ñ–µ—Ä–∞‚Äù ‚Äî —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –º–∞—Ç—Ä–∏—Ü/—Ç–∏—Ä–æ–≤.
- id
- supplier_item_id
- import_batch_id
- length_cm (nullable)
- pack_type (nullable: –±–∞–∫/—É–ø–∞–∫/‚Ä¶)
- pack_qty (nullable: 10/20/25‚Ä¶)
- price_type (fixed/range)
- price_min / price_max
- currency (RUB)
- tier_min_qty / tier_max_qty (nullable)
- availability_type (unknown/in_stock/preorder)
- stock_qty (nullable)
- validation_status (ok/warn/error)
- validation_notes

**–í–∞–∂–Ω–æ:**  
raw ‚Äú–º–∞—Ç—Ä–∏—Ü–∞‚Äù ‚Üí –º–Ω–æ–≥–æ `offer_candidate` –ø–æ (length_cm √ó pack_type).  
raw ‚Äú—Ç–∏—Ä—ã‚Äù ‚Üí –º–Ω–æ–≥–æ `offer_candidate` –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º qty.

---

### 3.4 NORMALIZED —Å–ª–æ–π (–∫–∞—Ç–∞–ª–æ–≥ + —Å–ª–æ–≤–∞—Ä–∏)

#### –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Ü–≤–µ—Ç–æ–≤ (NEW)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ç–∏–ø–æ–≤/—Å—É–±—Ç–∏–ø–æ–≤/—Å–æ—Ä—Ç–æ–≤:

```
flower_categories (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    ‚îî‚îÄ‚îÄ flower_types (–†–æ–∑–∞, –•—Ä–∏–∑–∞–Ω—Ç–µ–º–∞, –≠–≤–∫–∞–ª–∏–ø—Ç)
          ‚îú‚îÄ‚îÄ flower_subtypes (–ö—É—Å—Ç–æ–≤–∞—è, –°–ø—Ä–µ–π, –ü–∏–æ–Ω–æ–≤–∏–¥–Ω–∞—è)
          ‚îÇ     ‚îî‚îÄ‚îÄ subtype_synonyms
          ‚îú‚îÄ‚îÄ type_synonyms (—Ä–æ–∑–∞, —Ä–æ–∑—ã, rose ‚Üí –†–æ–∑–∞)
          ‚îî‚îÄ‚îÄ flower_varieties (Explorer, Freedom, Red Naomi)
                ‚îî‚îÄ‚îÄ variety_synonyms (—ç–∫—Å–ø–ª–æ—Ä–µ—Ä ‚Üí Explorer)
```

#### `flower_category`
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- id
- name (–°—Ä–µ–∑–∞–Ω–Ω—ã–µ —Ü–≤–µ—Ç—ã / –ó–µ–ª–µ–Ω—å / –°—É—Ö–æ—Ü–≤–µ—Ç—ã)
- slug (cut-flowers / greenery / dried)
- sort_order

#### `flower_type`
–¢–∏–ø —Ü–≤–µ—Ç–∫–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫).
- id
- category_id (FK, nullable)
- canonical_name (–†–æ–∑–∞)
- slug (rosa)
- meta (JSONB: avg_length_min, avg_length_max, etc.)
- is_active

#### `flower_subtype`
–°—É–±—Ç–∏–ø —Ü–≤–µ—Ç–∫–∞ (–∫—É—Å—Ç–æ–≤–∞—è, —Å–ø—Ä–µ–π, –ø–∏–æ–Ω–æ–≤–∏–¥–Ω–∞—è).
- id
- type_id (FK ‚Üí flower_types)
- name (–ö—É—Å—Ç–æ–≤–∞—è)
- slug (shrub)
- meta (JSONB)
- is_active

#### `type_synonym` / `subtype_synonym`
–°–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è —Ç–∏–ø–æ–≤/—Å—É–±—Ç–∏–ø–æ–≤.
- id
- type_id / subtype_id (FK)
- synonym (lowercase: "—Ä–æ–∑—ã", "rose", "–∫—É—Å—Ç–æ–≤–∞—è")
- priority (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö)

**CONSTRAINT**: synonym UNIQUE ‚Äî –æ–¥–∏–Ω —Å–∏–Ω–æ–Ω–∏–º –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω —Ç–∏–ø.

#### `flower_variety`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ—Ä—Ç–æ–≤.
- id
- type_id (FK ‚Üí flower_types, required)
- subtype_id (FK ‚Üí flower_subtypes, nullable)
- name (Explorer)
- slug (explorer)
- official_colors (ARRAY: ["–∫—Ä–∞—Å–Ω—ã–π"])
- typical_length_min / typical_length_max
- meta (JSONB)
- is_verified (bool: –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–æ–º)
- is_active

#### `variety_synonym`
–°–∏–Ω–æ–Ω–∏–º—ã —Å–æ—Ä—Ç–æ–≤.
- id
- variety_id (FK)
- synonym (lowercase: "—ç–∫—Å–ø–ª–æ—Ä–µ—Ä")
- priority

**–¢—Ä–∏–≥—Ä–∞–º–Ω—ã–π –∏–Ω–¥–µ–∫—Å**: `flower_varieties.name` –¥–ª—è fuzzy search.

---

#### `normalized_sku`
–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞.
- id
- product_type (rose/carnation/alstroemeria/greens/packaging/‚Ä¶)
- variety (nullable) ‚Äî —Å–æ—Ä—Ç/–ª–∏–Ω–µ–π–∫–∞ (–µ—Å–ª–∏ –≤–µ–¥—ë–º)
- color (nullable)
- length_cm (nullable) ‚Äî –µ—Å–ª–∏ –¥–ª–∏–Ω–∞ —è–≤–ª—è–µ—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç–æ–º SKU, –ª–∏–±–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –¥–ª–∏–Ω—É –≤ offer
- stem_count / bud_type / grade (nullable ‚Äî –Ω–∞ –±—É–¥—É—â–µ–µ)
- title (—á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ)
- search_tokens (tsvector/json)

> MVP-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–¥–ª–∏–Ω—É –¥–µ—Ä–∂–∞—Ç—å –≤ Offer**, –∞ –Ω–µ –≤ SKU.
SKU = "—á—Ç–æ —ç—Ç–æ", Offer = "–≤ –∫–∞–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–æ–¥–∞—ë—Ç—Å—è".

#### `dictionary_entry`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —Å–ª–æ–≤–∞—Ä—è/—Å–∏–Ω–æ–Ω–∏–º–æ–≤/–ø—Ä–∞–≤–∏–ª.
- id
- dict_type (product_type/color/variety/country/pack_type/stopwords/regex_rule)
- key
- value
- synonyms (array)
- rules_json (regex/replace/extract)
- status (active/deprecated)

> **Note**: `dictionary_entry` –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤/—Å—Ç—Ä–∞–Ω.
> –¢–∏–ø—ã —Ü–≤–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `flower_types` + `type_synonyms`.

#### `sku_mapping`
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ supplier_item ‚Üí normalized_sku.
- id
- supplier_item_id
- normalized_sku_id
- method (rule/manual/semantic)
- confidence (0..1)
- status (proposed/confirmed/rejected)
- decided_by (user_id nullable)
- decided_at
- notes

#### `normalization_task` (—Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä)
- id
- supplier_item_id
- reason (unknown_product/ambiguous/needs_dictionary/‚Ä¶)
- priority
- status (open/in_progress/done)
- assigned_to

---

### 3.5 PUBLISHED —Å–ª–æ–π (–æ—Ñ—Ñ–µ—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∑–∞–∫–∞–∑–æ–≤)

#### `offer`
–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ñ—Ñ–µ—Ä, –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —Ä–æ–∑–Ω–∏—Ü—ã.
- id
- supplier_id
- normalized_sku_id
- source_import_batch_id (–æ—Ç–∫—É–¥–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ)
- length_cm (nullable)
- pack_type (nullable)
- pack_qty (nullable)
- price_type (fixed/range)
- price_min / price_max
- currency
- tier_min_qty / tier_max_qty (nullable)
- is_active
- published_at

> Offer —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ `offer_candidate` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
> - `sku_mapping.status=confirmed`
> - `offer_candidate.validation_status=ok|warn` (–ø–æ –ø—Ä–∞–≤–∏–ª–∞–º)
> - supplier –∞–∫—Ç–∏–≤–µ–Ω

#### `supplier_delivery_rule`
–£—Å–ª–æ–≤–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞.
- id
- supplier_id
- city_id
- delivery_zone (geojson/enum)
- min_order_amount (nullable)
- min_order_qty (nullable)
- delivery_windows (json)
- notes

---

### 3.6 –ó–∞–∫–∞–∑—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä –¥–ª—è MVP)

#### `order`
- id
- buyer_id
- city_id
- status (draft/sent/accepted/rejected/partial/completed/canceled)
- created_at
- notes

#### `order_line`
- id
- order_id
- offer_id
- qty
- unit_price (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞)
- line_amount

#### `order_supplier_link`
–¢–∞–∫ –∫–∞–∫ –æ–¥–∏–Ω –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.
- id
- order_id
- supplier_id
- status (sent/accepted/rejected/partial)
- supplier_notes

#### `order_event`
–∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤.
- id
- order_id
- entity_type (order/order_supplier_link)
- from_status / to_status
- at
- payload_json

---

## 4) –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥–µ–ª–∏–Ω–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è (–ø—Ä–∏–Ω—è—Ç—ã–µ –¥–ª—è MVP)

1) **Offer ‚Äî –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç.**  
   –¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç (–¥–ª–∏–Ω–∞, —É–ø–∞–∫–æ–≤–∫–∞, –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å, –æ–±—ä—ë–º), –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –Ω–µ SKU.

2) **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º 3 —Å—Ö–µ–º—ã —Ü–µ–Ω—ã:**
   - fixed,
   - range (min/max),
   - tiers (qty ranges) —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫–∏ Offer —Å tier_min/max.

3) **–ú–∞—Ç—Ä–∏—Ü—ã —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –≤ ‚Äú–ø–ª–æ—Å–∫–∏–µ‚Äù OfferCandidate.**  
   –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä—ã –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äú–º–∞—Ç—Ä–∏—Ü—ã‚Äù –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞.

4) **Raw –Ω–µ–∏–∑–º–µ–Ω—è–µ–º.**  
   –õ—é–±—ã–µ –ø—Ä–∞–≤–∫–∏ ‚Äî —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å/–º–∞–ø–ø–∏–Ω–≥/–ø–µ—Ä–µ–ø—É–±–ª–∏–∫–∞—Ü–∏—é.

5) **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è (dictionary-driven) + manual-review queue.**

---

## 5) –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Data-flow)

1) Supplier –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–π—Å ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è `import_batch`
2) –§–∞–π–ª —Ä–µ–∂–µ—Ç—Å—è –Ω–∞ `raw_row` (–≤–∫–ª—é—á–∞—è group/header lines)
3) `parse_run` —Å–æ–∑–¥–∞—ë—Ç:
   - `supplier_item` (—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏),
   - `offer_candidate` (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –º–∞—Ç—Ä–∏—Ü/—Ç–∏—Ä–æ–≤)
4) –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:
   - –ø—Ä–∞–≤–∏–ª–∞/—Å–ª–æ–≤–∞—Ä—å –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç `sku_mapping (proposed)`
   - –∞–¥–º–∏–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí `confirmed`
5) –ü—É–±–ª–∏–∫–∞—Ü–∏—è:
   - –∏–∑ `offer_candidate` + `sku_mapping confirmed` —Å–æ–∑–¥–∞—é—Ç—Å—è `offers`
6) –†–æ–∑–Ω–∏—Ü–∞ –∏—â–µ—Ç/—Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É ‚Üí `order`, `order_line`
7) –ü–æ—Å—Ç–∞–≤—â–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç ‚Üí `order_event`

---

## 6) –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–∏—Å–∫—É/—Ñ–∏–ª—å—Ç—Ä–∞–º (–∏–∑ –º–æ–¥–µ–ª–∏)

–§–∏–ª—å—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç:
- product_type (—Ä–æ–∑–∞/‚Ä¶)
- length_cm
- price (min/max)
- supplier distance/zone (—á–µ—Ä–µ–∑ delivery rules)
- pack_type / pack_qty (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## 7) –ß—Ç–æ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–æ–∂–µ–Ω–æ (–≤ DDL –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ optional)

- –Ω–∞—Å—Ç–æ—è—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ ‚Äú–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏‚Äù (–ø–æ–∫–∞ snapshots/unknown)
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ API/1–°
- ML-–º–∞—Ç—á–∏–Ω–≥ (–ø–æ–∫–∞ rule/manual)
- –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ª–æ–≥–∏—Å—Ç–∏–∫–∞ (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —Ç–∞—Ä–∏—Ñ—ã)
- –ø–ª–∞—Ç–µ–∂–∏/–∫–æ–º–∏—Å—Å–∏–∏/–±–∏–ª–ª–∏–Ω–≥